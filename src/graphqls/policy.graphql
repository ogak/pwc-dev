query policies($filter: BaseScalar = {}, $withDetail: Boolean = false) {
  policies(filter: $filter) {
    collection {
      id
      title
      status
      policyCategoryId
      parentId
      policyCategory {
        id
        name
      }
      ancestry
      description
      ...policyFragment @include(if: $withDetail)
    }
    metadata {
      totalCount
      currentPage
      totalPages
      limitValue
    }
  }
}
query searchPolicies($filter: BaseScalar = {}, $limit: Int, $page: Int) {
  policies(filter: $filter, limit: $limit, page: $page) {
    collection {
      id
      title
      status
      policyCategoryId
      parentId
      policyCategory {
        id
        name
      }
      ancestry
      description
      ...policyFragment
    }
    metadata {
      totalCount
      currentPage
      totalPages
      limitValue
    }
  }
}

query policyTree(
  $filter: BaseScalar = {}
  $isTree: Boolean!
  $limit: Int
  $page: Int
) {
  policies(filter: $filter, limit: $limit, page: $page) {
    collection {
      ...policyBranch
      children @include(if: $isTree) {
        ...policyBranch
        children {
          ...policyBranch
          children {
            ...policyBranch
            children {
              ...policyBranch
              children {
                ...policyBranch
              }
            }
          }
        }
      }
    }
    metadata {
      totalCount
      currentPage
      totalPages
      limitValue
    }
  }
}

fragment policyBranch on Policy {
  id
  title
  parentId
  status
  ancestry
  policyCategory {
    id
    name
  }
}

query policy($id: ID!) {
  policy(id: $id) {
    ancestors {
      id
      title
    }
    ...policyFragment
    draft {
      id
      objectResult {
        ... on Policy {
          id
          title
          status
          policyCategory {
            id
            name
          }
          ancestry
          description
          parentId
          references {
            id
            name
          }
        }
      }
      objectChanges
    }
    hasEditAccess
    requestStatus
    requestEdit {
      id
      state
      user {
        id
        name
      }
    }
  }
}

fragment policyFragment on Policy {
  id
  title
  status
  createdAt
  updatedAt
  policyCategory {
    id
    name
  }
  ancestry
  description
  parentId
  references {
    id
    name
  }
  controlCount
  riskCount
  subCount
  children {
    id
    title
    policyCategory {
      id
      name
    }
    policyCategoryId
    references {
      id
      name
    }
    description
    parentId
    createdAt
    updatedAt
  }
  resources {
    id
    name
    rating
    totalRating
    visit
    resuploadUrl
    status
  }
  risks {
    id
    name
    status
    levelOfRisk
    typeOfRisk
  }
  controls {
    id
    description
    ...control
  }
  businessProcesses {
    id
    name
  }
}

mutation destroyPolicy($id: ID!) {
  destroyPolicy(input: { id: $id }) {
    clientMutationId
  }
}

mutation createPolicy($input: CreatePolicyInput!) {
  createPolicy(input: $input) {
    clientMutationId
    policy {
      id
    }
  }
}

mutation updatePolicy($input: UpdatePolicyInput!) {
  updatePolicy(input: $input) {
    clientMutationId
  }
}

mutation createSubPolicy($input: CreateSubPolicyInput!) {
  createSubPolicy(input: $input) {
    clientMutationId
  }
}

query policyDashboard {
  # POLICY
  reviewedPolicies: policies(filter: { status_eq: release }) {
    metadata {
      totalCount
    }
  }
  preparedPolicies: policies(
    filter: { status_in: ["draft", "waiting_for_review"] }
  ) {
    metadata {
      totalCount
    }
  }
  totalPolicies: policies(filter: {}) {
    metadata {
      totalCount
    }
  }

  # CONTROL
  reviewedControls: controls(filter: { status_eq: release }) {
    metadata {
      totalCount
    }
  }
  preparedControls: controls(
    filter: { status_in: ["draft", "waiting_for_review"] }
  ) {
    metadata {
      totalCount
    }
  }
  totalControls: controls(filter: {}) {
    metadata {
      totalCount
    }
  }

  # RISK
  reviewedRisks: risks(filter: { status_eq: release }) {
    metadata {
      totalCount
    }
  }
  preparedRisks: risks(filter: { status_in: ["draft", "waiting_for_review"] }) {
    metadata {
      totalCount
    }
  }
  totalRisks: risks(filter: {}) {
    metadata {
      totalCount
    }
  }
}

mutation createBookmarkPolicy($input: CreateBookmarkPolicyInput!) {
  createBookmarkPolicy(input: $input) {
    success
  }
}

mutation reviewPolicyDraft($id: ID!, $publish: Boolean!) {
  reviewPolicyDraft(input: { id: $id, publish: $publish }) {
    success
    errors
  }
}
